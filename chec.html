<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Memory Game</title>
<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Bangers&display=swap" rel="stylesheet">

<style>
body, html {
    margin:0;
    padding:0;
    width:100%;
    height:100%;
    font-family:Arial,sans-serif;
    text-align:center;
    overflow:hidden;
}

#videoPage,#startPage,#gamePage,.winnerPage,#adminPage{
    display:none;
    top:0;left:0;
    width:100%;
    height:100%;
    position:absolute;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    background-size:100% 100%;
}

#videoPage { display:flex; background:#000; }
#videoPage video { width:100%; height:100%; object-fit:cover; }

#startPage { display:flex; flex-direction:column; justify-content:center; align-items:center; }
#startPage video {
    position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-1;
}

#gamePage { flex-direction:column; background:url('https://lakshaniranaweera.github.io/Aru/back.jpeg') no-repeat center/cover; }

.grid { display:grid; grid-template-columns:repeat(4,160px); grid-gap:100px; padding-right:75px; margin-top:60px; }
.card { width:240px; height:240px; perspective:1000px; cursor:pointer; position:relative; }
.card-inner { width:100%; height:100%; position:relative; transform-style:preserve-3d; transition:0.3s; }
.card.flipped .card-inner { transform:rotateY(180deg); }
.card-front,.card-back { position:absolute; width:100%; height:100%; backface-visibility:hidden; border-radius:10px; }
.card-back { transform:rotateY(180deg); background-size:cover; background-position:center; }

.winnerPage {
    display:none;
    position:absolute;
    width:100%;
    height:100%;
    top:0; left:0;
    justify-content:center;
    align-items:center;
    background:#000;
}

.winnerPage video {
    width:100%;
    height:100%;
    object-fit:cover;
}

#countdown {
    position:absolute;
    bottom:300px;
    font-size:90px;
    font-weight:bold;
    color:#fff;
    text-shadow:2px 2px 5px #000;
}

.grid .card .card-front {
  background-image: url('https://lakshaniranaweera.github.io/Aru/logo.png');
  background-repeat:no-repeat;
  background-position:center;
  background-size:cover;
}

#adminPage { display:none; background:#222; color:#fff; z-index:9999; }
#adminPage h1 { font-size:50px; margin-bottom:30px; }
#adminForm { width:600px; display:flex; flex-direction:column; gap:15px; }
#adminForm label { font-size:24px; display:flex; justify-content:space-between; }
#adminForm input { font-size:22px; width:120px; text-align:center; padding:5px; }
#adminForm button { padding:15px; font-size:28px; background:#28a745; color:#fff; border-radius:20px; }

#settingsIcon {
  position: absolute;
  top: 20px;
  right: 20px;
  font-size: 48px;
  color: white;
  cursor: pointer;
  z-index: 10000;
}
</style>
</head>
<body>

<!-- SETTINGS -->
<div id="settingsIcon" onclick="openAdmin()">⚙️</div>

<!-- AUDIO -->
<audio id="pageSound" src="https://lakshaniranaweera.github.io/Aru/page.mp3" loop></audio>
<audio id="selectSound" src="https://lakshaniranaweera.github.io/Aru/select.mp3"></audio>
<audio id="winnerSound" src="https://lakshaniranaweera.github.io/Aru/winner.mp3"></audio>
<audio id="lossSound" src="https://lakshaniranaweera.github.io/Aru/loss.mp3"></audio>

<!-- ADMIN PAGE -->
<div id="adminPage">
  <h1>Game Settings</h1>
  <form id="adminForm">
    <label>Winner Count: <input type="number" id="prizeDrink"></label>
    <label>Game Time (seconds): <input type="number" id="gameTime"></label>
    <button type="button" onclick="saveAdminSettings()">Save Settings</button>
    <label>Play Count: <span id="playCountLabel"></span></label>
    <label>Remaining Winners: <span id="winnerCountLabel"></span></label>
  </form>
</div>

<!-- INTRO VIDEO PAGE -->
<div id="videoPage">
  <video autoplay id="introVideo">
    <source src="https://lakshaniranaweera.github.io/Aru/intro1.mp4" type="video/mp4">
  </video>
</div>

<div id="startPage" style="background:url('https://lakshaniranaweera.github.io/Aru/background.png') center/cover no-repeat;">
</div>

<!-- GAME PAGE -->
<div id="gamePage">
  <h2></h2>
  <br><br>
  <div class="grid" id="gameBoard"></div>
  <div id="countdown">20</div>
</div>

<!-- VIDEO RESULT PAGES -->
<div id="winnerDrink" class="winnerPage">
    <video autoplay loop>
        <source src="https://lakshaniranaweera.github.io/Aru/win.mp4" type="video/mp4">
    </video>
</div>

<div id="timeoutPage" class="winnerPage">
    <video autoplay loop>
        <source src="https://lakshaniranaweera.github.io/Aru/loss.mp4" type="video/mp4">
    </video>
</div>

<div id="noGiftPage" class="winnerPage">
    <video autoplay loop>
        <source src="https://lakshaniranaweera.github.io/Aru/loss.mp4" type="video/mp4">
    </video>
</div>

<script>
/* INTRO VIDEO ROTATION */
const introVideos = [
  "https://lakshaniranaweera.github.io/Aru/intro1.mp4",
  "https://lakshaniranaweera.github.io/Aru/intro2.mp4",
  "https://lakshaniranaweera.github.io/Aru/intro3.mp4"
];
let currentIntroIndex = 0;

function setNextIntroVideo() {
  const introVideo = document.getElementById("introVideo");
  introVideo.src = introVideos[currentIntroIndex];
  introVideo.load();
  introVideo.play().catch(()=>{});
  currentIntroIndex = (currentIntroIndex + 1) % introVideos.length;
}

/* Local Storage */
let defaultTime=20;

let gameTime = parseInt(localStorage.getItem("gameTime")) || defaultTime;
let playCount = parseInt(localStorage.getItem("playCount")) || 0;
let winnerCount = parseInt(localStorage.getItem("winnerCount")) || 0;

function saveSettings(key, value){
    localStorage.setItem(key, value);
}

/* Admin Panel */
function loadAdminForm(){
  document.getElementById("prizeDrink").value = winnerCount;
  document.getElementById("gameTime").value = gameTime;
  updateAdminPanelLabels();
}

function updateAdminPanelLabels(){
  document.getElementById("playCountLabel").innerText = playCount;
  document.getElementById("winnerCountLabel").innerText = winnerCount;
}

function saveAdminSettings(){
  winnerCount = parseInt(document.getElementById("prizeDrink").value);
  gameTime = parseInt(document.getElementById("gameTime").value);
  saveSettings("winnerCount", winnerCount);
  saveSettings("gameTime", gameTime);
  document.getElementById("adminPage").style.display = "none";
  updateAdminPanelLabels();
}

function openAdmin(){
  loadAdminForm();
  document.getElementById("adminPage").style.display="flex";
}

/* GAME LOGIC */
let selectedCards=[], matchedPairs=0, countdown=20, countdownInterval;

const pageSound=document.getElementById("pageSound");
const selectSound=document.getElementById("selectSound");
const winnerSound=document.getElementById("winnerSound");
const lossSound=document.getElementById("lossSound");
const introVideo = document.getElementById("introVideo");

/* STARTUP */
window.onload=()=>{
  document.getElementById("videoPage").style.display="flex";
  setNextIntroVideo();
  document.getElementById("videoPage").addEventListener("click", ()=> { pageSound.play().catch(()=>{}); goStart(); });
  document.getElementById("startPage").addEventListener("click", startGame);
};

introVideo.addEventListener("ended", setNextIntroVideo);

function pauseAllVideos(){ document.querySelectorAll("video").forEach(v=>v.pause()); }

function goStart(){
  pauseAllVideos();
  document.getElementById("videoPage").style.display="none";
  document.getElementById("startPage").style.display="flex";
  pageSound.play().catch(()=>{});
}

function startGame(){
  playCount++;
  saveSettings("playCount", playCount);
  updateAdminPanelLabels();
  document.getElementById("startPage").style.display="none";
  document.getElementById("gamePage").style.display="flex";
  pageSound.play().catch(()=>{});
  initBoard();
  startCountdown();
}

function initBoard(){
  matchedPairs=0; selectedCards=[];
  const images=[
    "https://lakshaniranaweera.github.io/Aru/1.jpg",
    "https://lakshaniranaweera.github.io/Aru/2.png",
    "https://lakshaniranaweera.github.io/Aru/3.jpg",
    "https://lakshaniranaweera.github.io/Aru/4.png",
    "https://lakshaniranaweera.github.io/Aru/5.png",
    "https://lakshaniranaweera.github.io/Aru/6.png"
  ];
  const cardImages=[...images,...images].sort(()=>0.5-Math.random());
  const board=document.getElementById("gameBoard");
  board.innerHTML="";
  cardImages.forEach(img=>{
    const card=document.createElement("div");
    card.classList.add("card");
    card.innerHTML=`<div class="card-inner"><div class="card-front"></div><div class="card-back" style="background-image:url('${img}')"></div></div>`;
    board.appendChild(card);
    card.addEventListener("click",()=>flipCard(card,img));
  });
}

function flipCard(card,img){
  if(selectedCards.length<2 && !card.classList.contains("flipped")){
    card.classList.add("flipped","selected");
    selectSound.play().catch(()=>{});
    selectedCards.push({card,img});
    if(selectedCards.length===2) setTimeout(checkMatch,400);
  }
}

function checkMatch(){
  const [a,b]=selectedCards;
  if(a.img===b.img){
    matchedPairs++;
    if(matchedPairs===6){
      clearInterval(countdownInterval);
      showWinner();
    }
  } else {
    a.card.classList.remove("flipped","selected");
    b.card.classList.remove("flipped","selected");
  }
  selectedCards=[];
}

function startCountdown(){
  countdown=gameTime;
  document.getElementById("countdown").innerText=countdown;
  countdownInterval=setInterval(()=>{
    countdown--;
    document.getElementById("countdown").innerText=countdown;
    if(countdown<=0){ clearInterval(countdownInterval); showTimeout(); }
  },1000);
}

function showWinner(){
  pageSound.pause();
  winnerSound.play().catch(()=>{});

  document.getElementById("gamePage").style.display="none";
  pauseAllVideos();

  if(winnerCount<=0){ showNoGift(); return; }

  winnerCount--;
  saveSettings("winnerCount", winnerCount);
  updateAdminPanelLabels();

  const p=document.getElementById("winnerDrink");
  p.style.display="flex";
  const video = p.querySelector("video");
  video.play().catch(()=>{});
  p.onclick=()=>goVideo();
}

function showTimeout(){
  pageSound.pause();
  lossSound.play().catch(()=>{});
  document.getElementById("gamePage").style.display="none";
  pauseAllVideos();
  const p=document.getElementById("timeoutPage");
  p.style.display="flex";
  p.querySelector("video").play().catch(()=>{});
  p.onclick=()=>goVideo();
}

function showNoGift(){
  pageSound.pause();
  lossSound.play().catch(()=>{});
  pauseAllVideos();
  const p=document.getElementById("noGiftPage");
  p.style.display="flex";
  p.querySelector("video").play().catch(()=>{});
  p.onclick=()=>goVideo();
}

function goVideo(){
  pauseAllVideos();
  document.querySelectorAll(".winnerPage").forEach(x=>x.style.display="none");
  document.getElementById("videoPage").style.display="flex";
  setNextIntroVideo();
  pageSound.play().catch(()=>{});
}
</script>
</body>
</html>
